<%inherit file="/main.html" />
<%block name="bodyclass">${course.css_class}</%block>
<%namespace name='static' file='/static_content.html'/>
<%block name="headextra">
    <%static:css group='course'/>
    <%namespace name='static' file='/static_content.html'/>
    <link href="${static.url('css/vendor/simplePagination/simplePagination.css')}" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="${static.url('js/vendor/flaviusmatis-simplePagination.js-7cefeb7/jquery.simplePagination.js')}"></script>
    <script type="text/javascript">
        var old_query = "${ old_query }";
        var search_results = '${ to_string(search_results)}';
        var current_filter = '${ current_filter }';
        var page = '${ page }';
    </script>
</%block>
<%include file="/courseware/course_navigation.html" args="active_page='search'" />

<div class="container">
    <div class="search-results">
        <div id="menu-container">
            <ul class="filter-menu">
            <li id="all" class="header-bar">
                <span class="filter-item"></span>
                Courseware
                <span class="count">${ search_results["all"]["total"] }</span>
                </span>
            </li>
            <li id="video" class="body-bar">
                <span class="filter-item">
                <span class="video-image"></span>
                Transcripts
                <span class="count">${ search_results["video"]["total"] }</span>
                </span>
            </li>
            <li id="problem" class="body-bar">
                <span class="filter-item">
                <span class="problem-image"></span>
                Problems
                <span class="count">${ search_results["problem"]["total"] }</span>
                </span>
            </li>
            </ul>
        </div>
        % if search_results[current_filter]["total"] > 0:
            <div class="search-container">
                <p class="search-context">
                    Showing ${search_results[current_filter]["total"]} results in courseware for ${course_id.split("/")[1]}
                </p>
                <p class="pagination-stub" style="text-align:center;"></p>
            % for result in search_results[current_filter]["results"][page]:
            <section>
                <a href=${result["url"]}>
                    <div class="result-container">
                        <div class="result-header">
                        <span class="${result['category']}-image"/>
                            <h1 class="result-title">${result["data"]['display_name']}</h1>
                        </div>
                        <div class="result-body">
                                <div class="thumbnail-wrapper">
                                    <div class="result-thumbnail">
                                    % if result.get("thumbnail", False):
                                        % if result['category'] == "problem":
                                            <img class="thumbnail" src='${result["thumbnail"]}' alt="${result['data']['display_name']}">
                                        % else: 
                                           <img class="thumbnail" src="${result['thumbnail']}" alt="${result['data']['display_name']}">
                                        % endif
                                    % else:
                                        <img class="thumbnail">
                                    % endif
                                    </div>
                                </div>
                            <div class="result-snippets">
                                <div class="snippet">
                                    ${result['snippets']}
                                </div>
                            </div>
                        </div>
                    </div>
                </a>
            </section>
            % endfor
        </div>
        % else:
            <h1 class="result-title no-results">No results found, please try again</h1>
        % endif
    </div>
</div>


<%!
    import json
    import re

    def to_string(context):
        return re.escape(json.dumps(context))
%>